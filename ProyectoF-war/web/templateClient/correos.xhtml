<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="primefaces"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <body>

        <ui:composition template="/template/menu.xhtml">

            <ui:define name="content">
                <div class="title-container">
                    <h1 class="correo-title">Solicitudes de correos</h1>
                </div>
                <div class="card">
                    <!-- Row for Search Fields, DatePicker, SelectOneMenu, and Dialog Button -->
                    <div class="p-grid" style="display: flex; align-items: center; gap: 20px;">
                        <!-- Search 1 -->
                        <div class="p-col" style="flex: 1;">
                            <div class="ui-inputgroup">
                                <p:inputText placeholder="Search 1" style="width: 100%;" />
                                <p:commandButton icon="pi pi-search" styleClass="ui-button-warning" />
                            </div>
                        </div>

                        <!-- DatePicker -->
                        <div class="p-col" style="flex: 1;">
                            <div class="field">
                                <p:datePicker id="button" value="#{calendarView.date7}" showIcon="true" showOnFocus="false" style="width: 100%;" />
                            </div>
                        </div>

                        <!-- SelectOneMenu -->
                        <div class="p-col" style="flex: 1;">
                            <div class="field">
                                <!-- Dropdown de usuarios con opciones dinámicas -->
                                <p:selectOneMenu id="hideNoselectionOption" value="#{aDUusarios.selectedUsuario}" style="width: 100%;">
                                    <p:ajax update="@this" process="@this" />
                                    <f:selectItem itemLabel="Todos los usuarios" itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItems value="#{aDUusarios.usuariosList}" var="usuario" 
                                                   itemLabel="#{usuario.nombre} #{usuario.apellidoPaterno}" itemValue="#{usuario.IDUsuario}" />
                                </p:selectOneMenu>
                            </div>
                        </div>

                        <!-- Button to open the dialog -->
                        <div class="p-col" style="flex: 1; text-align: right;">
                            <p:commandButton value="Registrar" onclick="PF('productDialog').show()" styleClass="ui-button-primary" />
                        </div>
                    </div>

                    <p:dialog header="INFORMACIÓN DEL CORREO" widgetVar="productDialog" modal="true" showEffect="fade"
                              hideEffect="fade" resizable="false" focus="none" dynamic="true">
                        <p:outputPanel id="productDetail" style="text-align:center;">
                            <div class="card" style="display: flex; flex-direction: row; gap: 20px; justify-content: center;">

                                <!-- Panel Izquierdo: Inputs y Labels -->
                                <h:form id="formInputs">
                                    <div style="width: 400px; height: 75vh; display: flex; flex-direction: column; gap: 20px; background-color: white; padding: 10px;">
                                        <!-- Fecha Emitida -->
                                        <div style="display: flex; align-items: center; justify-content: start;">
                                            <i class="pi pi-calendar-plus" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                            <p:outputLabel for="fecha" value="Fecha: " />
                                            <p:datePicker id="fecha" value="#{aDTicket.fechaEmitida}" style="margin-left: 10px;"
                                                          pattern="yyyy-MM-dd" showOnFocus="false" showIcon="true">
                                            </p:datePicker>
                                        </div>


                                        <!-- Hora Emitida -->
                                        <div style="display: flex; align-items: center; justify-content: start;">
                                            <i class="pi pi-clock" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                            <p:outputLabel for="time" value="Hora: " />
                                            <p:datePicker id="time" value="#{aDTicket.horaEmitida}" timeOnly="true" 
                                                          pattern="HH:mm:ss" mindate="#{calendarView.minTime}" maxdate="#{calendarView.maxTime}" 
                                                          style="margin-left: 17px;" />
                                        </div>

                                        <!-- Plataforma -->
                                        <div style="display: flex; align-items: center; justify-content: start;">
                                            <i class="pi pi-globe" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                            <p:outputLabel for="platform" value="Plataforma:" />
                                            <p:selectOneRadio id="platform" value="#{aDPlataformas.selectedPlataforma}" layout="lineDirection" 
                                                              style="margin-left: 30px; width: 270px;">
                                                <f:selectItems value="#{aDPlataformas.plataformasList}" var="plataforma" 
                                                               itemLabel="#{plataforma.nombre}" itemValue="#{plataforma.IDPlataforma}" />
                                            </p:selectOneRadio>
                                        </div>

                                        <!-- Municipio -->
                                        <div style="display: flex; align-items: center; justify-content: start;">
                                            <i class="pi pi-map-marker" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                            <p:outputLabel for="municipio" value="Municipio: " />
                                            <p:selectOneMenu id="municipio" value="#{aDMunicipios.selectedMunicipio}" 
                                                             style="margin-left: 33px; width: 240px; max-width: 240px;">
                                                <f:selectItem itemLabel="Selecciona un Municipio" itemValue="" />
                                                <f:selectItems value="#{aDMunicipios.municipiosList}" var="municipio" 
                                                               itemLabel="#{municipio.num} - #{municipio.nombre}" itemValue="#{municipio.IDMunicipio}" />
                                            </p:selectOneMenu>
                                        </div>

                                        <!-- Correo -->
                                        <div style="display: flex; align-items: center; justify-content: start; margin-top: 0px;">
                                            <i class="pi pi-envelope" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                            <p:outputLabel for="correo" value="Correo: " />
                                            <p:selectOneMenu id="correo" value="#{aDCorreos.selectedCorreo}" 
                                                             style="margin-left: 53px; width: 240px; max-width: 240px;">
                                                <f:selectItem itemLabel="Selecciona un correo" itemValue="" />
                                                <f:selectItems value="#{aDCorreos.correosList}" var="correo" 
                                                               itemLabel="#{correo.correo}" itemValue="#{correo.IDCorreo}" />
                                            </p:selectOneMenu>
                                        </div>

                                        <!-- Responsable -->
                                        <div style="display: flex; align-items: center; justify-content: start; margin-top: 0px;">
                                            <i class="pi pi-user" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                            <p:outputLabel for="responsable" value="Responsable: " />
                                            <p:selectOneMenu id="responsable" value="#{aDUusarios.selectedUsuario}" 
                                                             style="margin-left: 10px; width: 240px; max-width: 240px;">
                                                <f:selectItem itemLabel="Selecciona un usuario" itemValue="0" />
                                                <f:selectItems value="#{aDUusarios.usuariosList}" var="usuario" 
                                                               itemLabel="#{usuario.nombre} #{usuario.apellidoPaterno}" itemValue="#{usuario.IDUsuario}" />
                                            </p:selectOneMenu>
                                        </div>

                                        <!-- Asunto -->
                                        <div style="display: flex; align-items: center; justify-content: start; flex-direction: column; gap: 5px;">
                                            <div style="display: flex; align-items: center; width: 100%;">
                                                <i class="pi pi-paperclip" style="font-size: 1.3rem; margin-right: 10px;"></i>
                                                <p:outputLabel for="asunto" value="Asunto:" />
                                            </div>
                                            <p:inputTextarea id="asunto" rows="6" cols="33" style="width: 100%;" value="#{aDDetalleCorreo.asunto}"/>
                                        </div>
                                    </div>
                                    <!-- Botón para procesar ambos formularios -->
                                    <div style="position: absolute; bottom: 10px; right: 10px;">
                                        <p:commandButton value="Guardar Todo" icon="pi pi-save" ajax="true" action="#{aDTicket.guardarTicketParcial}"
                                                         process="@form" update="@form" style="background-color: #28a745; color: white; border: none; padding: 5px 15px; border-radius: 3px; font-size: 12px; cursor: pointer;" />
                                    </div>


                                </h:form>

                                <!-- Panel Derecho: Subida de Archivo -->
                                <h:form id="uploadForm" enctype="multipart/form-data">
                                    <div style="width: 500px; display: flex; flex-direction: column; gap: 10px;">
                                        <!-- Formulario para subir archivo -->
                                        <div style="display: flex; align-items: center; justify-content: flex-start; gap: 5px;">
                                            <p:fileUpload value="#{aDDocument.file}" mode="simple" skinSimple="true"  label="Añadir"/>
                                            <p:commandButton value="Ver" ajax="true" action="#{aDDocument.upload}" 
                                                             update="uploadedFilePanel" styleClass="mt-3 ui-button-outlined block" />
                                        </div>

                                        <!-- Panel para mostrar el archivo subido -->
                                        <h:panelGroup id="uploadedFilePanel" layout="block" style="margin-top: 10px;">
                                            <iframe src="#{aDDocument.currentUrl}" width="450px" height="400px" frameborder="0">
                                                Your browser can't display the PDF.
                                                <h:outputLink value="#{aDDocument.currentUrl}" target="_blank">Click here to download the file.</h:outputLink>
                                            </iframe>
                                        </h:panelGroup>
                                    </div>
                                </h:form>
                            </div>
                        </p:outputPanel>
                    </p:dialog>

                    <!-- Contenedor Principal para los Cuatro Carruseles -->
                    <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 1em;">

                        <!-- Primer Carrusel -->
                        <h:form id="carouselForm1">
                            <div class="card" style="padding: 10px; width: 230px; flex-shrink: 0;">
                                <p:carousel value="#{aDDetalleCorreo.listaDetallesProceso1}" var="detalle" orientation="vertical"
                                            verticalViewPortHeight="400px" style="width: 230px; margin-bottom: 0;"
                                            numVisible="2" numScroll="2" styleClass="custom-carousel">
                                    <f:facet name="header">
                                        <h5 style="text-align: center; font-size: 1.1em; margin-bottom: 5px;">Sin Asignar</h5>
                                    </f:facet>

                                    <div class="product-item" style="padding: 5px; margin-bottom: 1px;">
                                        <div class="product-item-content" 
                                             style="padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 5px;
                                             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); text-align: center; font-size: 0.9em;">
                                            <h4 style="font-size: 1em; color: #333; margin-bottom: 5px; font-weight: bold;">Asunto: #{detalle.asunto}</h4>
                                            <p style="font-size: 0.9em; color: #555;">Municipio ID: #{aDDetalleCorreo.externoByID(detalle.externoID).municipioID}</p>
                                            <p style="font-size: 0.9em; color: #555;">Plataforma ID: #{aDDetalleCorreo.externoByID(detalle.externoID).plataformaID}</p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Fecha Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).fechaRecibida}">
                                                    <f:convertDateTime pattern="dd-MM-yyyy" />
                                                </h:outputText>
                                            </p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Hora Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).horaRecibida}">
                                                    <f:convertDateTime pattern="HH:mm:ss" />
                                                </h:outputText>
                                            </p>
                                        </div>
                                    </div>
                                </p:carousel>
                            </div>
                        </h:form>


                        <!-- Segundo Carrusel -->
                        <h:form id="carouselForm2">
                            <div class="card" style="padding: 10px; width: 230px; flex-shrink: 0;">
                                <!-- Cambiamos el value para que use la lista filtrada -->
                                <p:carousel value="#{aDDetalleCorreo.listaDetallesProceso3}" var="detalle" orientation="vertical"
                                            verticalViewPortHeight="400px" style="width: 230px; margin-bottom: 0;"
                                            numVisible="2" numScroll="2" styleClass="custom-carousel">
                                    <f:facet name="header">
                                        <h5 style="text-align: center; font-size: 1.1em; margin-bottom: 5px;">En Proceso</h5>
                                    </f:facet>
                                    <div class="product-item" style="padding: 5px; margin-bottom: 1px;">
                                        <div class="product-item-content" 
                                             style="padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 5px;
                                             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); text-align: center; font-size: 0.9em;">
                                            <h4 style="font-size: 1em; color: #333; margin-bottom: 5px; font-weight: bold;">Asunto: #{detalle.asunto}</h4>
                                            <p style="font-size: 0.9em; color: #555;">Municipio ID: #{aDDetalleCorreo.externoByID(detalle.externoID).municipioID}</p>
                                            <p style="font-size: 0.9em; color: #555;">Plataforma ID: #{aDDetalleCorreo.externoByID(detalle.externoID).plataformaID}</p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Fecha Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).fechaRecibida}">
                                                    <f:convertDateTime pattern="dd-MM-yyyy" />
                                                </h:outputText>
                                            </p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Hora Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).horaRecibida}">
                                                    <f:convertDateTime pattern="HH:mm:ss" />
                                                </h:outputText>
                                            </p>
                                        </div>
                                    </div>
                                </p:carousel>
                            </div>
                        </h:form>


                        <h:form id="carouselForm3">
                            <div class="card" style="padding: 10px; width: 230px; flex-shrink: 0;">
                                <p:carousel value="#{aDDetalleCorreo.listaDetallesProceso2}" var="detalle" orientation="vertical"
                                            verticalViewPortHeight="400px" style="width: 230px; margin-bottom: 0;"
                                            numVisible="2" numScroll="2" styleClass="custom-carousel">
                                    <f:facet name="header">
                                        <h5 style="text-align: center; font-size: 1.1em; margin-bottom: 5px;">Por Autorizar</h5>
                                    </f:facet>

                                    <div class="product-item" style="padding: 5px; margin-bottom: 1px;">
                                        <div class="product-item-content" 
                                             style="padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 5px;
                                             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); text-align: center; font-size: 0.9em;">
                                            <h4 style="font-size: 1em; color: #333; margin-bottom: 5px; font-weight: bold;">Asunto: #{detalle.asunto}</h4>
                                            <p style="font-size: 0.9em; color: #555;">Municipio ID: #{aDDetalleCorreo.externoByID(detalle.externoID).municipioID}</p>
                                            <p style="font-size: 0.9em; color: #555;">Plataforma ID: #{aDDetalleCorreo.externoByID(detalle.externoID).plataformaID}</p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Fecha Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).fechaRecibida}">
                                                    <f:convertDateTime pattern="dd-MM-yyyy" />
                                                </h:outputText>
                                            </p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Hora Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).horaRecibida}">
                                                    <f:convertDateTime pattern="HH:mm:ss" />
                                                </h:outputText>
                                            </p>
                                        </div>
                                    </div>
                                </p:carousel>
                            </div>
                        </h:form>

                        <h:form id="carouselForm4">
                            <div class="card" style="padding: 10px; width: 230px; flex-shrink: 0;">
                                <p:carousel value="#{aDDetalleCorreo.listaDetallesProceso4}" var="detalle" orientation="vertical"
                                            verticalViewPortHeight="400px" style="width: 230px; margin-bottom: 0;"
                                            numVisible="2" numScroll="2" styleClass="custom-carousel">
                                    <f:facet name="header">
                                        <h5 style="text-align: center; font-size: 1.1em; margin-bottom: 5px;">Completados</h5>
                                    </f:facet>
                                    <div class="product-item" style="padding: 5px; margin-bottom: 1px;">
                                        <div class="product-item-content" 
                                             style="padding: 8px; background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 5px;
                                             box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); text-align: center; font-size: 0.9em;">
                                            <h4 style="font-size: 1em; color: #333; margin-bottom: 5px; font-weight: bold;">Asunto: #{detalle.asunto}</h4>
                                            <p style="font-size: 0.9em; color: #555;">Municipio ID: #{aDDetalleCorreo.externoByID(detalle.externoID).municipioID}</p>
                                            <p style="font-size: 0.9em; color: #555;">Plataforma ID: #{aDDetalleCorreo.externoByID(detalle.externoID).plataformaID}</p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Fecha Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).fechaRecibida}">
                                                    <f:convertDateTime pattern="dd-MM-yyyy" />
                                                </h:outputText>
                                            </p>
                                            <p style="font-size: 0.9em; color: #555;">
                                                Hora Recibida: 
                                                <h:outputText value="#{aDDetalleCorreo.ticketByID(aDDetalleCorreo.externoByID(detalle.externoID).ticketID).horaRecibida}">
                                                    <f:convertDateTime pattern="HH:mm:ss" />
                                                </h:outputText>
                                            </p>
                                        </div>
                                    </div>
                                </p:carousel>
                            </div>
                        </h:form>


                    </div>

                    <!-- Estilo para ocultar la paginación -->
                    <style>
                        .custom-carousel .ui-carousel-indicators {
                            display: none !important;
                        }
                    </style>


                </div>
            </ui:define>

        </ui:composition>

    </body>
</html>
